#include "stdafx.h"
#include "TTimer.h"
#include "User.h"
#include "TMessages.h"
#include "Object.h"
#include "DSXProtocol.h"
#include "TSetup.h"
#include "TConfig.h"
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// # Made By [RCZ]ShadowKing -> GS 99.60T -> Only for MuOnline.co.il

//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

boost::timer g_boostTimer;

CTimer::CTimer(void)
{

	// ----
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CTimer::~CTimer(void)
{
	// ----
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

void CTimer::Init()
{
	m_Tick			= GetTickCount();
	m_Ticket		= 0;
	// ----
	m_bWorker		= true;
	// ----
	m_nMilliseconds	= 0;
	m_nSeconds		= 0;
	m_nMinutes		= 0;
	m_nHours		= 0;
	m_nDays			= 0;
	// ----
	boost::thread	worker(TimerWorker, this);
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

DWORD CTimer::TimerWorker(LPVOID lpParam)
{
	CTimer  * lpThis = (CTimer *)lpParam;
	//boost::posix_time::milliseconds workTime(1);
	boost::posix_time::milliseconds workTime(1000);
	// ----
	while(lpThis->m_bWorker)
	{
		/*if(lpThis->m_nMilliseconds == 1000)
		{
			lpThis->m_nMilliseconds = 0;
			lpThis->m_nSeconds++;
			// ----
			lpThis->OnSecond();
		}*/
		// ----
		if(lpThis->m_nSeconds == 60)
		{
			lpThis->m_nSeconds = 0;
			lpThis->m_nMinutes++;
			// ----
			lpThis->OnMinute();
		}
		// ----
		if(lpThis->m_nMinutes == 60)
		{
			lpThis->m_nMinutes = 0;
			lpThis->m_nHours++;
			// ----
			lpThis->OnHour();
		}
		// ----
		if(lpThis->m_nHours == 24)
		{
			// ----
			lpThis->m_nHours = 0;
			lpThis->m_nDays++;			
		}
		// ----
		lpThis->m_nSeconds++;
		// ----
		boost::this_thread::sleep(workTime);
	}
	// ----
	return true;
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

void CTimer::OnSecond()
{

}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

void CTimer::OnMinute()
{

}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

void CTimer::OnHour()
{
	GDSendStartupMSG(g_Config.nServerCode);
	// ----
	if(m_Ticket >= 10)
	{
		m_Ticket = 0;
		// ----
		_beginthread(ObjectVIPCheck, 0 , 0);
	}
	else m_Tick++;
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------